/*


 jQuery Micro version 0.1.5

 Pico/Nano like editor for jquery

 http://micro.jcubic.pl

 Licensed under GNU GPL Version 3 license
 Copyright (c) 2013 Jakub Jankiewicz <http://jcubic.pl>

 Contain:

 sprintf.js
 Copyright (c) 2007-2013 Alexandru Marasteanu <hello at alexei dot ro>
 licensed under 3 clause BSD license

 Date: Sun, 10 Apr 2016 17:19:31 +0000
*/
(function(f){function m(i){return Object.prototype.toString.call(i).slice(8,-1).toLowerCase()}var k=function(){k.cache.hasOwnProperty(arguments[0])||(k.cache[arguments[0]]=k.parse(arguments[0]));return k.format.call(null,k.cache[arguments[0]],arguments)};k.format=function(i,j){var b=1,d=i.length,a="",c=[],g,e,h,l;for(g=0;g<d;g++){a=m(i[g]);if(a==="string")c.push(i[g]);else if(a==="array"){h=i[g];if(h[2]){a=j[b];for(e=0;e<h[2].length;e++){if(!a.hasOwnProperty(h[2][e]))throw k('[sprintf] property "%s" does not exist',
h[2][e]);a=a[h[2][e]]}}else a=h[1]?j[h[1]]:j[b++];if(/[^s]/.test(h[8])&&m(a)!="number")throw k("[sprintf] expecting number but found %s",m(a));switch(h[8]){case "b":a=a.toString(2);break;case "c":a=String.fromCharCode(a);break;case "d":a=parseInt(a,10);break;case "e":a=h[7]?a.toExponential(h[7]):a.toExponential();break;case "f":a=h[7]?parseFloat(a).toFixed(h[7]):parseFloat(a);break;case "o":a=a.toString(8);break;case "s":a=(a=String(a))&&h[7]?a.substring(0,h[7]):a;break;case "u":a>>>=0;break;case "x":a=
a.toString(16);break;case "X":a=a.toString(16).toUpperCase()}a=/[def]/.test(h[8])&&h[3]&&a>=0?"+"+a:a;e=h[4]?h[4]=="0"?"0":h[4].charAt(1):" ";l=h[6]-String(a).length;if(h[6]){for(var n=[];l>0;n[--l]=e);e=n.join("")}else e="";c.push(h[5]?a+e:e+a)}}return c.join("")};k.cache={};k.parse=function(i){for(var j=[],b=[],d=0;i;){if((j=/^[^\x25]+/.exec(i))!==null)b.push(j[0]);else if((j=/^\x25{2}/.exec(i))!==null)b.push("%");else if((j=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(i))!==
null){if(j[2]){d|=1;var a=[],c=j[2],g=[];if((g=/^([a-z_][a-z_\d]*)/i.exec(c))!==null)for(a.push(g[1]);(c=c.substring(g[0].length))!=="";)if((g=/^\.([a-z_][a-z_\d]*)/i.exec(c))!==null)a.push(g[1]);else if((g=/^\[(\d+)\]/.exec(c))!==null)a.push(g[1]);else throw"[sprintf] huh?";else throw"[sprintf] huh?";j[2]=a}else d|=2;if(d===3)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";b.push(j)}else throw"[sprintf] huh?";i=i.substring(j[0].length)}return b};f.sprintf=k;f.vsprintf=
function(i,j,b){b=j.slice(0);b.splice(0,0,i);return k.apply(null,b)}})(typeof exports!="undefined"?exports:window);
(function(f,m){function k(b,d){for(var a="",c=d;c--;)a+=b;return a}function i(b,d){this._root=f(b);this._letter=this._calculate_letter_size();this._root.addClass("micro");this._root.css({width:d.width,height:d.height});this._settings=d;this._title=f("<div/>").addClass("title").appendTo(this._root);this._set_file_name("");this._spacer=f("<div/>").addClass("spacer").appendTo(this._root);this._input=f("<input/>").appendTo(this._spacer);this._clipboard=f("<textarea/>").addClass("clipboard").appendTo(this._spacer);
this._table=f("<div/>").addClass("matrix");this._lines=[""];this._unsaved=false;this.refresh();this._pointer={x:0,y:0};this._matrix[0][0].addClass("cursor");this._table.appendTo(this._root);this._footer=f("<div/>").addClass("footer").appendTo(this._root);this._footer_line_1=f("<div/>").addClass("line1").appendTo(this._footer);this._footer_line_2=f("<div/>").addClass("line2").appendTo(this._footer);this._message=f("<div/>").addClass("message").append("<span/>").appendTo(this._root).find("span");this._cursor_offset=
this._page=this._offset=0;var a=this;this._print_footer_keys(j);this._input.bind("keydown.micro",function(c){if(a._focus){var g=a._lines[a._pointer.y],e=a._tabs_count(g);if(c.which===37){e=a._lines[a._pointer.y-1];if(a._pointer.x>0)a._set_pointer(a._pointer.x-1,a._pointer.y);else a._pointer.x===0&&e!==m&&a._set_pointer(e.length,a._pointer.y-1);c.preventDefault()}else if(c.which===39){if(a._pointer.x<g.length)a._set_pointer(a._pointer.x+1,a._pointer.y);else a._pointer.x===g.length&&a._lines[a._pointer.y+
1]!==m&&a._set_pointer(0,a._pointer.y+1);c.preventDefault()}else if(c.which===38){a._pointer.y>0&&a._set_pointer(a._pointer.x,a._pointer.y-1);c.preventDefault()}else if(c.which===40){a._pointer.y<a._lines.length-1&&a._set_pointer(a._pointer.x,a._pointer.y+1);c.preventDefault()}else if(c.which===35){a._set_pointer(g.length,a._pointer.y);c.preventDefault()}else if(c.which===36){a._set_pointer(0,a._pointer.y);c.preventDefault()}else if(c.which===8)if(a._pointer.x===0){if(a._pointer.y>0){e=a._lines[a._pointer.y-
1].length;a._lines[a._pointer.y-1]+=a._lines[a._pointer.y];a._lines.splice(a._pointer.y,1);a._set_pointer(e,a._pointer.y-1);a._view(a._offset);this._unsaved=true}}else{if(a._pointer.x>0){e=a._pointer.x>g.length?g.length-e:a._pointer.x;a._lines[a._pointer.y]=g.slice(0,e-1)+g.slice(e,g.length);a._draw_cursor_line();a._set_pointer(e-1,a._pointer.y)}else{e=a._lines[a._pointer.y-1];a._lines=a._lines.slice(0,a._pointer.y-1).concat(a._lines.slice(a._pointer.y));a._lines[a._pointer.y-1]=e+g;a._pointer.y--;
a._pointer.x=e.length-1;a._set_pointer(a._pointer.x,a._pointer.y);a._view(a._offset)}this._unsaved=true}else if(c.which===46)if(g.length===a._pointer.x){if(a._lines.length>a._pointer.y+1){a._lines[a._pointer.y]+=a._lines[a._pointer.y+1];a._lines=a._lines.slice(0,a._pointer.y+1).concat(a._lines.slice(a._pointer.y+2));a._view(a._offset);this._unsaved=true}}else{a._lines[a._pointer.y]=g.slice(0,a._pointer.x)+g.slice(a._pointer.x+1,g.length);a._draw_cursor_line();this._unsaved=true}else if(c.which===
13){e=g.slice(a._pointer.x);a._lines[a._pointer.y]=g.slice(0,a._pointer.x);a._lines.splice(a._pointer.y+1,0,e);a._set_pointer(0,a._pointer.y+1);a._view(a._offset);this._unsaved=true}if(c.ctrlKey)if(c.which===86){a._clipboard.val("").focus();setTimeout(function(){a.insert(a._clipboard.val());a._clipboard.val("");a._input.focus();this._unsaved=true},100)}else if(c.which===79){if(typeof a._settings.save==="function"){a._settings.save.apply(a._root);this._unsaved=false}else a.message("[ "+f.micro.strings.no_save+
" ]");c.preventDefault()}else c.which===88&&typeof a._settings.exit==="function"&&a._settings.exit.apply(a._root);a._settings.cursorPosition||(c.ctrlKey&&c.which===67?a._print_cur_position():a.message(""))}}).bind("keypress.micro",function(c){if(!c.ctrlKey){var g=String.fromCharCode(c.which);if(g!=="\r"){a.insert(g);a._unsaved=true}}c.preventDefault()});f(document).bind("click.micro",function(c){c=f(c.target).parents(".micro");c.length?c.data("micro").focus():a.blur()});this._table.on("click","span",
function(){var c=f(this),g=a._offset+c.parents(".line").index(),e=c.index();c=a._lines[a._pointer.y];var h=a._get_cursor_offset();if(h>0&&a._pointer.y==g){var l=a._tabs_count(c);e=h+e-1-l;if(e>c.length-l)e=c.length-l;a._set_pointer(e,g)}else{a._cursor_offset>0&&a._pointer.y!=g&&a._draw_line(a._pointer.y-a._offset,c);if(a._lines[g]){if(e>a._lines[g].length)e=a._lines[g].length;a._set_pointer(e,g)}}});d.enabled?this.focus():this.blur()}var j=1;i.prototype={_print_footer_line:function(b,d){var a=this,
c=Math.round(this._cols/b.length)-3;f.each(b,function(g,e){f("<span>"+e[0]+"</span>").addClass("key").appendTo(d);var h;h=e[1].length>c?e[1].substring(0,c):e[1].length<c?e[1]+k(" ",c-e[1].length):e[1];f("<span>"+a._encode(" "+h)+"</span>").appendTo(d)})},_print_footer_keys:function(b){var d,a;switch(b){case j:d=[["^G",f.micro.strings.get_help],["^O",f.micro.strings.write_out],["^R",f.micro.strings.read_file],["^Y",f.micro.strings.prev_page],["^K",f.micro.strings.cut_text],["^C",f.micro.strings.cur_pos]];
a=[["^X",f.micro.strings.exit],["^J",f.micro.strings.justify],["^W",f.micro.strings.where_is],["^V",f.micro.strings.next_page],["^U",f.micro.strings.uncut_text],["^T",f.micro.strings.to_spell]]}d&&this._print_footer_line(d,this._footer_line_1);a&&this._print_footer_line(a,this._footer_line_2)},insert:function(b){var d=b.split("\n"),a=this._lines[this._pointer.y],c=a.slice(this._pointer.x);this._lines[this._pointer.y]=a.slice(0,this._pointer.x)+d[0];if(d.length==1){this._lines[this._pointer.y]+=c;
this._set_pointer(this._pointer.x+b.length,this._pointer.y);this._draw_cursor_line()}else{d[0]=a.slice(0,this._pointer.x)+d[0];b=d[d.length-1].length;d[d.length-1]+=c;this._lines=this._lines.slice(0,this._pointer.y-1).concat(d).concat(this._lines.slice(this._pointer.y+1));this._set_pointer(b,this._pointer.y+d.length-2);this._view(this._offset)}},focus:function(){this._focus=true;this._table.find(".inactive").removeClass("inactive").css({width:"",height:""});this._input.focus()},blur:function(){this._focus=
false;this._table.find(".cursor").addClass("inactive").css({width:this._letter.width-2,height:this._letter.height-2})},cols:function(){return this._cols},rows:function(){return this._rows},destroy:function(){this._root.removeData("micro").removeClass("micro");this._table.remove();this._input.unbind(".micro");this._spacer.remove();this._title.remove();this._footer.remove();this._root.find(".message").remove();f(document).unbind(".micro")},clear:function(b){this._letter=this._calculate_letter_size();
this._rows=Math.floor(this._root.height()/this._letter.height)-4;this._cols=Math.floor(this._root.width()/this._letter.width);this._matrix=[];this._table.empty();for(var d=0;d<this._rows;++d){var a=f("<div/>").addClass("line").appendTo(this._table);this._matrix[d]=[];for(var c=0;c<this._cols;++c){var g=f("<span>&nbsp;</span>").appendTo(a);this._matrix[d][c]=g}}b&&this._set_file_name("")},refresh:function(){this.clear();if(this._pointer){this._view(this._offset);this._set_pointer(this._pointer.x,this._pointer.y)}return this},
set:function(b){this._lines=b.split("\n");this._set_pointer(0,0);this._view(0)},get:function(){return this._lines.join("\n")},_print_cur_position:function(){var b=0,d=0,a=this;f.each(this._lines,function(g,e){if(g<a._pointer.y)b+=e.length;else if(g==a._pointer.y)b+=a._pointer.x;d+=e.length});var c=this._lines[this._pointer.y];this.message("[ "+sprintf(f.micro.strings.chr,this._pointer.y+1,this._lines.length,(this._pointer.y+1)*100/this._lines.length,this._pointer.x+1,c.length+1,(this._pointer.x+1)*
100/(c.length+1),b,d,b*100/d)+" ]")},_set_pointer:function(b,d){if(d>=this._lines.length||d<0)throw Error("[micro::_set_pointer]: Y out of band ("+d+"/"+this._lines.length+")");this._table.find(".cursor").removeClass("cursor");var a=this._lines[d],c=this._lines[this._pointer.y],g=this._tabs_count(a);if(c)var e=this._tabs_count(c);d!=this._pointer.y&&e&&this._pointer.x>=this._cols-e-1&&this._draw_line(this._pointer.y-this._offset,this._lines[this._pointer.y]);if(b>a.length)b=a.length;else if(b<0)b=
0;a=Math.floor(this._rows/2);e=this._offset+this._rows-a;if(d-this._offset>=this._rows){c=d-e;if(this._offset!==e){this._pointer.x=b;this._pointer.y=d;this._view(e)}}else if(d-this._offset<0){a=this._offset-this._rows+a;this._pointer.x=b;this._pointer.y=d;this._view(a);c=d-a}else{c=d-e+a+1;e%a===0&&c--}if(b+g>=this._cols-1){this._pointer.x=b;this._pointer.y=d;this._draw_cursor_line()}else{this._pointer.x+g>=this._cols-1&&this._draw_line(this._pointer.y-this._offset,this._lines[this._pointer.y]);b>
this._lines[d].length?this._matrix[c][this._lines[d].length].addClass("cursor"):this._matrix[c][b].addClass("cursor")}this._pointer.x=b;this._pointer.y=d;this._settings.cursorPosition&&this._print_cur_position()},_encode:function(b){return b.replace(/ /g,"&nbsp;").replace(/\t/g,k("&nbsp;",this._settings.tabStop))},_draw_line:function(b,d){var a=d.length>this._cols?this._cols:d.length,c;for(c=0;c<a;++c)this._matrix[b][c].html(this._encode(d[c]));a=this._tabs_count(d);if(d.length+a>this._cols){this._matrix[b][this._cols-
1-a].html("$");if(a>0)for(c=this._cols-a;c<this._cols;++c)this._matrix[b][c].html("&nbsp")}else for(c=d.length;c<this._cols;++c)this._matrix[b][c].html("&nbsp")},_get_cursor_offset:function(){var b=this._tabs_count(this._lines[this._pointer.y]);return(this._cols-this._settings.horizontalMoveOffset-1)*Math.floor((this._pointer.x+b)/(this._cols-1))-b},_tabs_count:function(b){return(b.match(/(\t)/g)||[]).length*3},_draw_cursor_line:function(){var b=this._pointer.y-this._offset,d=this._lines[this._pointer.y],
a=this._tabs_count(d);if(this._pointer.x+a>=this._cols-1){var c=this._get_cursor_offset();this._draw_line(b,"$"+d.substring(c,c+this._cols));this._matrix[b][(this._pointer.x+a)%(this._cols-1)+this._settings.horizontalMoveOffset+1].addClass("cursor")}else this._draw_line(b,d)},_view:function(b){if(this._lines){this._offset=b;var d=this._lines.slice(b,b+this._rows),a=this._pointer.y-b;if(d[a].length>this._cols&&this._pointer.x>this._cols){for(b=0;b<a;++b)this._draw_line(b,d[b]);this._draw_cursor_line();
for(b=a+1;b<d.length;++b)this._draw_line(b,d[b])}else f.each(d,this._draw_line.bind(this));if(d.length<this._rows)for(b=d.length;b<this._rows;++b)this._draw_line(b,"")}return this},version:function(){return"0.1.5".match(/^\{\{V\}\}$/,"0.1.5")?"":"0.1.5"},_set_file_name:function(b){var d="  jQuery Micro "+this.version();d+=k(" ",30-d.length)+f.micro.strings.file+": "+b;this._title.html(d.replace(/ /g,"&nbsp;"))},message:function(b){this._message.html(this._encode(b))},open:function(b,d){var a=this;
f.get(b,function(c){a._set_file_name(b.replace(/.*\//,""));a._lines=c.split("\n");a._view(0);a._set_pointer(0,0);typeof d==="function"&&d()},"text");return this},_calculate_letter_size:function(){var b=f('<div class="micro"><div><span>&nbsp;</span></div></div>').appendTo("body"),d=b.find("span").width(),a=b.find("div").height();b.remove();return{width:d,height:a}}};f.micro={defaults:{enabled:true,tabStop:4,cursorPosition:false,save:null,exit:null,width:"100%",height:"400px",verticalMoveOffset:9,horizontalMoveOffset:6},
strings:{file:"File",read:"Read %s Lines",chr:"line %d/%d (%d%%), col %d/%d (%d%%), char %d/%d (%d%%)",no_save:"You need to provide save function",get_help:"Get Help",exit:"Exit",write_out:"WriteOut",justify:"Justify",read_file:"Read File",where_is:"Where is",prev_page:"Prev Page",next_page:"Next Page",cut_text:"Cut Text",uncut_text:"Uncut Text",cur_pos:"Cur Pos",to_spell:"To Speel"},init:i,fn:i.prototype};f.fn.micro=function(b){if(typeof b==="string"){var d=Array.prototype.slice.call(arguments);
d.shift();if(b[0]!=="_"&&typeof f.micro.fn[b]==="function")if(this.length==1){var a=f(this).data("micro");return f.micro.fn[b].apply(a,d)}else return f.each(this,function(){var g=f(this).data("micro");f.micro.fn[b].apply(g,d)});else return this}else{var c=f.extend({},f.micro.defaults,b);return f.each(this,function(){f(this).data("micro",new f.micro.init(this,c))})}}})(jQuery);
